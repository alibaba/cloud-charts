# CloudCharts 重构说明

## 📋 本次重构的核心目标

您需要建立一套**需求驱动的面向AI编码的智能图形组件库**，具体目标：

1. ✅ **React 升级** → 18 以上版本
2. ✅ **G2 升级** → 5.x 版本（与开源保持一致）
3. ✅ **构建工具** → Webpack → Vite（更高效）
4. ✅ **AI 主导** → 未来由人提供需求，AI 主导编程

## 📁 已生成的文档

### 1. **AI-知识库文档.md** ⭐
**用途**: AI 编程的"大脑"，包含：
- 项目架构详解
- 核心组件工作原理
- 数据流和配置系统
- 主题和国际化机制
- 智能规则系统

**AI 使用场景**: 
```
用户: "帮我添加一个散点图"
AI: 阅读知识库 → 理解架构 → 生成代码
```

### 2. **重构计划书.md** 📊
**用途**: 完整的重构路线图，包含：
- 7个阶段的详细计划
- 时间估算（23-38工作日）
- 风险评估和应对
- 成功标准

**使用场景**: 
```
作为项目经理的执行手册
作为技术负责人的决策依据
```

### 3. **实施指南.md** 🚀
**用途**: 立即可执行的操作步骤，包含：
- 立即要做的4个任务
- 完整的代码示例
- 常见问题解决
- 命令速查表

**使用场景**: 
```
今天就开始重构
遇到问题时查阅
```

## 🎯 推荐执行顺序

### 如果您想**立即开始**:

```
第1天: 
  → 阅读 实施指南.md
  → 执行任务 1.1-1.4
  → 验证构建系统

第2-3天:
  → 升级到 React 18
  → 运行测试确保兼容

第4-8天:
  → 升级到 G2 5.x
  → 重写 Base.tsx
  → 测试核心图表

第9-15天:
  → 迁移到 Hooks
  → 建立 AI 编程体系
  → 完善文档
```

### 如果您想**先了解**:

```
1. 阅读 AI-知识库文档.md (30分钟)
   → 理解当前架构
   → 了解技术细节

2. 阅读 重构计划书.md (20分钟)
   → 了解整体规划
   → 评估时间成本

3. 阅读 实施指南.md (15分钟)
   → 了解具体操作
   → 准备开始
```

## 🔑 关键概念速查

### 当前架构
```
React 17 + Webpack 4 + G2 4.x
  ↓ 类组件 + SCSS + Babel 6
```

### 目标架构
```
React 18 + Vite + G2 5.x
  ↓ Hooks + TypeScript + AI 辅助
```

### 核心变化
| 模块 | 旧 | 新 | 影响 |
|------|----|----|------|
| 构建 | Webpack 4 | Vite | 速度↑ 5x |
| React | 17 | 18 | API 兼容 |
| G2 | 4.x | 5.x | 需重写渲染逻辑 |
| 代码风格 | 类组件 | Hooks | 渐进迁移 |
| 开发体验 | 手动 | AI 辅助 | 效率↑ |

## 💡 AI 编程示例

### 场景 1: 新增图表类型

**用户需求**:
```
"我需要一个箱线图，数据格式是：
[
  { name: '系列1', data: [['类别1', [1, 5, 8, 12]]] }
]
配置需要支持颜色、标签、工具提示"
```

**AI 执行流程**:
1. 阅读知识库 → 理解 Wbar 架构
2. 参考 Wbar 实现 → 创建 Wboxplot
3. 适配 G2 5.x API
4. 生成测试用例
5. 输出完整代码

### 场景 2: 修复 Bug

**用户需求**:
```
"柱状图在大数据量时卡顿，需要自动开启缩略轴"
```

**AI 执行流程**:
1. 阅读知识库 → 找到大数据规则系统
2. 查看 rule/bigData.ts
3. 修改阈值和处理逻辑
4. 添加测试验证

### 场景 3: 性能优化

**用户需求**:
```
"图表渲染太慢，需要优化"
```

**AI 执行流程**:
1. 分析性能瓶颈
2. 参考知识库中的性能优化章节
3. 实现虚拟滚动/数据采样
4. 添加性能测试

## 📋 检查清单

### 开始前
- [ ] 备份当前代码
- [ ] 检查 Node.js 版本 >= 18
- [ ] 阅读所有文档
- [ ] 准备测试数据

### 执行中
- [ ] 每个阶段完成后测试
- [ ] 更新文档
- [ ] 提交 Git

### 完成后
- [ ] 所有测试通过
- [ ] 文档完整
- [ ] 性能达标
- [ ] 用户验证

## 🆘 遇到问题？

### 1. 构建失败
→ 查看 实施指南.md 的"常见问题"章节

### 2. 类型错误
→ 检查 TypeScript 配置
→ 阅读 AI-知识库文档.md 的类型定义部分

### 3. G2 API 不工作
→ 对比 G2 4.x 和 5.x 文档
→ 参考知识库中的 API 映射表

### 4. 不确定如何继续
→ 回到 重构计划书.md
→ 按阶段执行，不要跳步

## 🎓 学习路径

### 新手级 (1-2天)
1. 阅读 README.md
2. 运行 Storybook
3. 理解 Wbar 使用方式

### 进阶级 (3-5天)
1. 阅读 AI-知识库文档.md
2. 理解 Base.tsx 架构
3. 尝试修改配置项

### 专家级 (1-2周)
1. 完整阅读重构计划书
2. 执行实施指南
3. 贡献代码

## 📞 下一步行动

### 今天就可以做:
```bash
# 1. 创建备份
git tag backup-2026-01-09

# 2. 阅读实施指南
cat 实施指南.md

# 3. 安装工具
npm install -D vite @vitejs/plugin-react

# 4. 创建配置
# 复制实施指南中的 vite.config.ts
```

### 明天继续:
```bash
# 1. 测试构建
npm run build

# 2. 升级 React
npm install react@^18.2.0 react-dom@^18.2.0

# 3. 运行测试
npm test
```

## 📊 预期收益

完成重构后，您将获得:

| 指标 | 当前 | 目标 | 提升 |
|------|------|------|------|
| 构建速度 | 30s | 5s | 6x |
| 包体积 | 500KB | 350KB | -30% |
| 维护成本 | 高 | 低 | -40% |
| 开发效率 | 1x | 2x | +100% |
| AI 支持 | 无 | 完整 | 全新 |

## 🎯 成功标准

当您看到以下情况时，说明重构成功:

✅ `npm run build` 在 10 秒内完成  
✅ 所有图表在 React 18 + G2 5.x 下正常工作  
✅ 类型提示准确无误  
✅ 测试覆盖率 > 80%  
✅ AI 可以基于文档生成可用代码  

---

**祝您重构顺利！** 🚀

如有问题，随时查阅上述文档。

**文档版本**: 1.0  
**生成时间**: 2026-01-09

